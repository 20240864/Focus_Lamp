# 机械臂Home位置设置指南

本指南将帮助您设置机械臂的初始home位置，用于Focus Lamp系统的初始化。

## 概述

Focus Lamp系统需要一个预定义的"home"位置作为机械臂的初始状态。通过手动摆放机械臂到理想位置并记录关节角度，系统可以在启动时自动回到这个位置。

## 提供的脚本

### 1. `set_home_position.py` (完整版)
功能完整的设置脚本，包含详细的用户交互和错误处理。

**特点：**
- 详细的步骤说明
- 位置确认功能
- 完整的错误处理
- 显示当前关节角度

### 2. `quick_set_home.py` (快速版)
简化版本，适合熟悉操作的用户快速设置。

**特点：**
- 简洁的操作流程
- 快速执行
- 最少的用户交互

## 使用步骤

### 方法一：使用完整版脚本

1. **运行脚本**
   ```bash
   python set_home_position.py
   ```

2. **连接确认**
   - 脚本会自动从 `lelamp/focus/focus_config.json` 读取设备配置
   - 确认连接到正确的设备和端口

3. **手动摆放**
   - 手动将机械臂摆放到您希望的home位置
   - 这个位置应该是：
     - 安全的（不会碰撞到其他物体）
     - 美观的（符合您的审美要求）
     - 实用的（便于后续动作执行）

4. **记录位置**
   - 摆放完成后按Enter键
   - 脚本会显示当前所有关节的角度值

5. **确认保存**
   - 确认位置正确后输入 'y' 保存
   - 位置信息会保存到 `lelamp/follower/{lamp_id}.json`

### 方法二：使用快速版脚本

1. **运行脚本**
   ```bash
   python quick_set_home.py
   ```

2. **摆放并记录**
   - 手动摆放机械臂到目标位置
   - 按Enter键直接保存当前位置

## 配置文件说明

设置完成后，home位置信息会保存在 `lelamp/follower/{lamp_id}.json` 文件中的 `homing_offset` 字段：

```json
{
  "id": "lelamp",
  "motors": {
    "base_yaw": {"id": 1, "model": "xl330-m077"},
    "base_pitch": {"id": 2, "model": "xl330-m077"},
    "elbow_pitch": {"id": 3, "model": "xl330-m077"},
    "wrist_pitch": {"id": 4, "model": "xl330-m077"},
    "wrist_roll": {"id": 5, "model": "xl330-m077"}
  },
  "homing_offset": {
    "base_yaw": 0.123,
    "base_pitch": -0.456,
    "elbow_pitch": 0.789,
    "wrist_pitch": -0.234,
    "wrist_roll": 0.567
  }
}
```

## 注意事项

1. **安全第一**
   - 设置home位置时确保机械臂不会与周围物体碰撞
   - 选择一个稳定、安全的位置

2. **电源连接**
   - 确保机械臂已正确连接电源
   - 确保USB/串口连接正常

3. **权限问题**
   - 在Linux系统上可能需要sudo权限访问串口
   - 确保用户有读写配置文件的权限

4. **备份配置**
   - 建议在修改前备份现有的配置文件
   - 可以设置多个不同的home位置进行测试

## 验证设置

设置完成后，您可以通过以下方式验证：

1. **运行Focus Lamp主程序**
   ```bash
   cd lelamp/focus
   python main.py
   ```

2. **观察启动行为**
   - 系统启动时会先执行nod动作
   - 然后调用go_home回到您设置的位置
   - 确认机械臂确实回到了预期位置

## 故障排除

### 连接问题
- 检查 `focus_config.json` 中的端口设置
- 确认设备ID正确
- 检查物理连接

### 权限问题
- Linux: `sudo chmod 666 /dev/ttyACM*`
- 或将用户添加到dialout组

### 角度异常
- 如果记录的角度看起来异常，请重新设置
- 确保机械臂在设置时处于稳定状态

## 高级用法

### 设置多个预设位置
您可以修改脚本来保存多个预设位置，例如：
- 工作位置
- 休息位置  
- 展示位置

### 批量设置
对于多个设备，可以修改脚本支持批量设置不同设备的home位置。

---

设置完成后，您的Focus Lamp系统就可以正常使用预定义的home位置了！